//------------------------------------------------------------------------------
// <auto-generated>
//     このコードはツールによって生成されました。
//     ランタイム バージョン:4.0.30319.42000
//
//     このファイルへの変更は、以下の状況下で不正な動作の原因になったり、
//     コードが再生成されるときに損失したりします。
// </auto-generated>
//------------------------------------------------------------------------------
using UnityEngine;
using System.Xml;

public class Stage
{
	public class Cell
	{
		public enum Duty
		{
			Null,
			Plus,
			Minus,
			Mult,
			Div,
			Equal,
		}
		
		public GameObject _go;
		public Duty _duty;
	}

	private Cell[][] _cells;
	private int _numCellX = 10;
	private int _numCellY = 10;

	public Stage ()
	{



	}

	public bool Load(GameObject floorBlockPrehab)
	{
		// xmlデータのURL
		string XMLFilePath = "http://hakuhou.space/__tmp__/test.xml";
		XmlDocument doc;	// XMLオブジェクト
		XmlNodeList nodeListText;//テキストの配列
		
		doc = new XmlDocument();// XMLオブジェクトを生成
		doc.Load(XMLFilePath);// XMLのファイルを読み込む
			
		// 全部配列
		nodeListText = doc.SelectNodes("stage");	// テキストの配列の読み込み
			
		// 表示
		Debug.Log(nodeListText[0].InnerText);















		_cells = new Cell[_numCellX][];
		for (int i = 0; i < _numCellX; i++)
		{
			_cells[i] = new Cell[_numCellY];
			for (int j = 0; j < _numCellY; j++)
			{
				_cells[i][j] = new Cell();
				
				GameObject go = (GameObject)UnityEngine.Object.Instantiate (floorBlockPrehab, new Vector3(i - (_numCellX * 0.5f), -1.0f, j - (_numCellY * 0.5f)), Quaternion.identity);
				
				/*
				// 適当な色テスト
				go.renderer.material.color = (((i + j) & 0x1) == 0) ? Color.gray : Color.black;

				// 適当なテクスチャテスト
				go.renderer.material.mainTexture =  Resources.Load("Floor/plus") as Texture2D;
				*/
				
				_cells[i][j]._go = go;
				_cells[i][j]._duty = (Random.value < 0.5f) ? (Cell.Duty)Random.Range ((int)Cell.Duty.Null, (int)Cell.Duty.Equal) : Cell.Duty.Null;
				
				// 床テクスチャの読み込み
				string texname = "";
				switch(_cells[i][j]._duty)
				{
				case Cell.Duty.Null:	texname = "normal";		break;
				case Cell.Duty.Plus:	texname = "plus";		break;
				case Cell.Duty.Minus:	texname = "minus";		break;
				case Cell.Duty.Mult:	texname = "mult";		break;
				case Cell.Duty.Div:		texname = "div";		break;
				case Cell.Duty.Equal:	texname = "equal";		break;
				}
				_cells[i][j]._go.renderer.material.mainTexture = Resources.Load("Floor/" + texname) as Texture2D;
			}
		}

		return true;
	}

	public Cell GetCellFromPosition(Vector3 pos)
	{
		int ix = PosXToIndexX (pos.x);
		int iy = PosZToIndexY (pos.z);
		if ((0 <= ix) && (ix < _numCellX) && (0 <= iy) && (iy < _numCellY))
		{
			return _cells[ix][iy];
		}

		return null;
	}
	
	private int PosXToIndexX(float x)
	{
		return (int)(x + (_numCellX * 0.5f));
	}
	
	private int PosZToIndexY(float z)
	{
		return (int)(z + (_numCellY * 0.5f));
	}
}

